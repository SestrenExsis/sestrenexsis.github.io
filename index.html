<!DOCTYPE html>
<html>
  <body>
    <h1>Dracula Spawn Patterns</h1>
		<div><img src="dracula_spawn.png"></img></div>
		<div><input id="dracula-spawn-pattern"></div>
    <div id="first-possible-seed" style="white-space:pre;"></div>
    <script type="text/javascript">//<![CDATA[
var dracula_spawn_pattern = document.querySelector('#dracula-spawn-pattern');
var first_possible_seed = document.querySelector('#first-possible-seed');
var MOD = 0x100000000;
var spawn_indexes = [81, 210, 339, 468];

var spawns = [1, 2, 3, 4, 6, 7, 8, 5];

function mul32(a, b)
{
	// From: https://stackoverflow.com/questions/6232939/
  a >>>= 0;
  b >>>= 0;
  let lo = a & 0xffff;
  let hi = a - lo;
  let result = (((hi * b) >>> 0) + (lo * b)) >>> 0;
  return result
}

function hex(value, padding) {
  let result = value.toString(16).toUpperCase();
  while (result.length < padding) {
    result = "0" + result;
  }
  return result;
}

function NiceRng() {
	this.seed = 0x00000000;
  this.index = 0;
}

NiceRng.prototype.current = function () {
  let result = 0xff & (this.seed >> 0x18);
  return result;
}

NiceRng.prototype.next = function () {
	this.seed = (mul32(0x01010101, this.seed) + 1) % MOD;
  this.index += 1;
  let result = this.current();
  return result;
}

dracula_spawn_pattern.addEventListener('input', function() {
	let rng = new NiceRng();
  let patterns = [];
  if (dracula_spawn_pattern.value.length < 4) {
  	first_possible_seed.textContent = 'first possible seed: n/a\n';
  }
  else {
  	first_possible_seed.textContent = 'first possible seed: calculating ...\n';
  	    while (true) {
        	let pattern = spawns[rng.current() & 7];
  	      patterns.push(pattern);
  	      rng.next();
  	      let n = patterns.length;
  	      if (n < 412) {
  	        continue;
  	      }
  	      if (patterns[n - 388] != parseInt(dracula_spawn_pattern.value.charAt(0))) {
  	        continue;
  	      }
  	      if (patterns[n - 259] != parseInt(dracula_spawn_pattern.value.charAt(1))) {
  	        continue;
  	      }
  	      if (patterns[n - 130] != parseInt(dracula_spawn_pattern.value.charAt(2))) {
  	        continue;
  	      }
  	      if (patterns[n - 1] != parseInt(dracula_spawn_pattern.value.charAt(3))) {
  	        continue;
  	      }
  	      break;
  	    }
  	    first_possible_seed.textContent = 'first possible seed: ' + (patterns.length - 469) + '\n';
  	    rng.next()
  }
});
  //]]></script>
  </body>
</html>
